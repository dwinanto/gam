<!doctype html>
<html>

<head>
    <title>Infinite content example</title>
    <script async src="https://securepubads.g.doubleclick.net/tag/js/gpt.js"></script>
    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-remote-config.js"></script>
    <script>
        window.googletag = window.googletag || { cmd: [] };

        googletag.cmd.push(function () {
            // Declare slots initially present on the page
            googletag.defineSlot('/6355419/Travel', [728, 90], 'leaderboard')
                .setTargeting("test", "infinitescroll")
                .addService(googletag.pubads());

            // Enable SRA to honor competetive exclusions and roadblocks.
            googletag.pubads().enableSingleRequest();

            // Enable services
            googletag.enableServices();
        });

        // Function to add content to page
        function moreContent() {
            // Define the slot itself, register it and fetch an ad.
            googletag.cmd.push(function () {
                var slot = googletag.defineSlot('/6355419/Travel', [728, 90])
                    .setTargeting('test', 'infinitescroll')
                    .addService(googletag.pubads());

                var div = document.createElement('div');
                div.id = slot.getSlotElementId(); // auto-generated by GPT
                document.body.appendChild(div);

                // Call display() to register the slot as ready and fetch an ad.
                googletag.display(slot);
            });
        }
    </script>

    <style>
        body {
            min-height: 700px;
        }

        body>div {
            margin-bottom: 5em;
            border: solid 1px black;
            width: 728px
        }

        body>button {
            position: fixed;
            bottom: 10px;
        }
    </style>
</head>

<body>
    <h1>GPT Test Page - Infinite Content WandaT</h1>

    <!-- First ad -->
    <div id="leaderboard">
        <script>
            // Call display() to register the slot as ready and fetch an ad.
            googletag.cmd.push(function () {
                googletag.display('leaderboard');
            });
        </script>
    </div>

    <!-- Button to load more content dynamically. -->
    <button onclick="moreContent()">More Content</button>
    <div id="welcome_message">welcome_message</div>
    <div id="foo">Hello</div>
    <div id="foo1">HelloW1</div>
    <div id="foo2">HelloW2</div>
    <div id="foo3">HelloW3</div>
    <div id="foo4">HelloW4</div>
    <div id="foo5">HelloW5</div>


    <script>

        var firebaseConfig = {
            apiKey: "AIzaSyB3K5WuoObzk5VfLuxvksqbVOspP-WrzEA",
            authDomain: "avengers-gold.firebaseapp.com",
            projectId: "avengers-gold",
            storageBucket: "avengers-gold.appspot.com",
            messagingSenderId: "751876414940",
            appId: "1:751876414940:web:9e48be6a618fd9ec7f8319",
            measurementId: "G-GMPTS2X81N"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const analytics = firebase.analytics();
        analytics.logEvent('notification_received', {
            content_type: 'image',
            content_id: 'P12453',
            items: [{ name: 'Kittens' }]
        });

        const remoteConfig = firebase.remoteConfig();
        remoteConfig.settings = {
            fetchTimeMillis: 60000,
            minimumFetchIntervalMillis: 300000
        }

        remoteConfig.fetchAndActivate()
            .then(() => {
                const val = remoteConfig.getValue('welcome_messsage');
                const ads_location = remoteConfig.getValue('ads_location');
                
                console.log(val);
                console.log(ads_location);

                const welcome_element = document.getElementById('welcome_message');
                welcome_element.innerText = val._value + ' (' + val._source + ')';
            })
            .catch((err) => {
                console.error('Firebase Remote Config failed to fetch and activate', err);
            });


        function insertAfter(referenceNode, newNode) {
            referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);
        }
        // Function to add content to page
        function injectAds(targetNode) {
            googletag.cmd.push(function () {
                var slot = googletag.defineSlot('/6355419/Travel', [728, 90])
                    .setTargeting('test', 'infinitescroll')
                    .addService(googletag.pubads());

                var div = document.createElement('div');
                div.id = slot.getSlotElementId(); // auto-generated by GPT

                tempNode = document.getElementById(targetNode);
                insertAfter(tempNode, div);
                googletag.display(slot);
            });
        }
        //targetlist = ['foo1', 'foo2', 'foo3', 'foo4', 'foo5'];
        targetlist = ads_location.split(" ");
        for (let i = 0; i < targetlist.length; i++) {
            console.log(targetlist[i]);
            injectAds(targetlist[i]);
        }    
    </script>
</body>

</html>
